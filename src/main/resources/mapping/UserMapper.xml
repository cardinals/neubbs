<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.neusoft.neubbs.dao.IUserDAO">
    <resultMap id="UserMap" type="org.neusoft.neubbs.entity.UserDO">
        <id column="fu_id" property="id" javaType="Integer" jdbcType="INTEGER" />
        <result column="fu_name" property="name" javaType="String" jdbcType="VARCHAR" />
        <result column="fu_password" property="password" javaType="String" jdbcType="VARCHAR" />
        <result column="fu_email" property="email" javaType="String" jdbcType="VARCHAR" />
        <result column="fu_sex" property="sex" javaType="Integer" jdbcType="VARCHAR" />
        <result column="fu_birthday" property="birthday" javaType="String" jdbcType="VARCHAR" />
        <result column="fu_position" property="position" javaType="String" jdbcType="VARCHAR" />
        <result column="fu_description" property="description" javaType="String" jdbcType="VARCHAR" />
        <result column="fu_image" property="image" javaType="String" jdbcType="VARCHAR" />
        <result column="fu_rank" property="rank" javaType="String" jdbcType="VARCHAR" />
        <result column="fu_state" property="state" javaType="Integer" jdbcType="INTEGER" />

        <!-- 设置 DATE 会丢失h:m:s精度 -->
        <result column="fu_createtime" property="createtime" javaType="java.util.Date" jdbcType="TIMESTAMP" />
    </resultMap>

    <!-- 注意：insert,delete,update 默认都是返回影响行数-->
    <insert id="saveUser" parameterType="org.neusoft.neubbs.entity.UserDO" useGeneratedKeys="true" keyProperty="fu_id">
        INSERT INTO forum_user (fu_name,fu_password,fu_email)
        VALUES (#{name, jdbcType = VARCHAR},
                #{password, jdbcType = VARCHAR},
                #{email, jdbcType = VARCHAR})
        <selectKey resultType="java.lang.Integer" keyProperty="id" order="AFTER"><!-- id from UserDO , After Do-->
            SELECT LAST_INSERT_ID() AS fu_id
        </selectKey>
    </insert>

    <delete id="removeUserById" parameterType="java.lang.Integer">
        DELETE FROM forum_user WHERE fu_id = #{id, jdbcType = INTEGER}
    </delete>

    <select id="getUserMaxId" resultType="java.lang.Integer"><!-- 获取最新（最大值）插入的 id -->
        SELECT MAX(fu_id) FROM forum_user;
    </select>
    <select id="getUserById" parameterType="java.lang.Integer" resultMap="UserMap">
        SELECT fu_id,fu_name,fu_password,fu_email,fu_sex,fu_birthday,fu_position,fu_description,fu_image,fu_rank,fu_state,fu_createtime
        FROM forum_user WHERE fu_id = #{id, jdbcType = INTEGER};
    </select>
    <select id="getUserByName" parameterType="java.lang.String" resultMap="UserMap">
        SELECT fu_id,fu_name,fu_password,fu_email,fu_sex,fu_birthday,fu_position,fu_description,fu_image,fu_rank,fu_state,fu_createtime
        FROM forum_user WHERE fu_name = #{name, jdbcType = VARCHAR};
    </select>
    <select id="getUserByEmail" parameterType="java.lang.String" resultMap="UserMap">
        SELECT fu_id,fu_name,fu_password,fu_email,fu_sex,fu_birthday,fu_position,fu_description,fu_image,fu_rank,fu_state,fu_createtime
        FROM forum_user WHERE fu_email = #{email, jdbcType = VARCHAR};
    </select>
    <select id="listAllAdminUser" resultMap="UserMap"><!-- <![CDATA[ ]]>内容会被解析器忽略 -->
        <![CDATA[
                  SELECT fu_id,fu_name,fu_password,fu_email,fu_sex,fu_birthday,fu_position,fu_description,fu_image,fu_rank,fu_state,fu_createtime
                 FROM forum_user WHERE fu_rank = 'admin';
            ]]>
    </select>
    <select id="listAssignDateRegisterUserByYearMonth" resultMap="UserMap">
        SELECT fu_id,fu_name,fu_password,fu_email,fu_sex,fu_birthday,fu_position,fu_description,fu_image,fu_rank,fu_state,fu_createtime
        FROM forum_user
        WHERE YEAR(fu_createtime) = #{param1, jdbcType = INTEGER} AND MONTH(fu_createtime) = #{param2, jdbcType = INTEGER};
    </select>
    <select id="listAllUser" resultMap="UserMap">
        SELECT fu_id,fu_name,fu_password,fu_email,fu_sex,fu_birthday,fu_position,fu_description,fu_image,fu_rank,fu_state,fu_createtime
        FROM forum_user;
    </select>

    <update id="updateUserPasswordByName">
        UPDATE forum_user SET fu_password = #{param2, jdbcType = VARCHAR}
        WHERE fu_name = #{param1, jdbcType = VARCHAR}
    </update>
    <update id="updateUserEmailByName">
        UPDATE forum_user SET fu_email = #{param2, jdbcType = VARCHAR}
        WHERE fu_name = #{param1, jdbcType = VARCHAR}
    </update>
    <update id="updateUserRankByName">
        UPDATE forum_user SET fu_rank = #{param2, jdbcType = VARCHAR}
        WHERE fu_name = #{param1, jdbcType = VARCHAR}
    </update>
    <update id="updateUserImageByName">
        UPDATE forum_user SET fu_image = #{param2, jdbcType = VARCHAR}
        WHERE fu_name = #{param1, jdbcType = VARCHAR}
    </update>
    <update id="updateUserStateForActivationByEmail" parameterType="String">
        UPDATE forum_user SET fu_state = 1
        WHERE fu_email = #{email, jdbcType = VARCHAR}
    </update>
    <update id="truncateUserTable"><!-- 删减表  ${tableName}-->
        TRUNCATE TABLE forum_user
    </update>
</mapper>
